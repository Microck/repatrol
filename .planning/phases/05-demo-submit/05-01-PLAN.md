---
phase: 05-demo-submit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/core/orchestrator.py
  - src/core/__init__.py
  - src/core/run_config.py
  - scripts/run_swarm.py
autonomous: true

must_haves:
  truths:
    - "A single orchestrator command can run Explorer + Chaos and route bugs to Reporter"
    - "Runs are time-bounded and produce a single artifacts bundle"
  artifacts:
    - path: "src/core/orchestrator.py"
      provides: "Swarm orchestrator coordinating agents"
      contains: "class TestOrchestrator"
    - path: "scripts/run_swarm.py"
      provides: "CLI entry to run full swarm"
      contains: "--mode"
  key_links:
    - from: "src/core/orchestrator.py"
      to: "src/agents/explorer_agent.py"
      via: "ExplorerAgent"
      pattern: "ExplorerAgent"
    - from: "src/core/orchestrator.py"
      to: "src/agents/chaos_agent.py"
      via: "ChaosAgent"
      pattern: "ChaosAgent"
    - from: "src/core/orchestrator.py"
      to: "src/agents/reporter_agent.py"
      via: "ReporterAgent"
      pattern: "ReporterAgent"
---

<objective>
Build the test orchestrator that coordinates agents end-to-end in a single command.

Purpose: DEMO-01 requires a cohesive flow, not separate scripts.
Output: `TestOrchestrator` + `scripts/run_swarm.py`.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@src/agents/explorer_agent.py
@src/agents/chaos_agent.py
@src/agents/reporter_agent.py
@src/automation/recorder.py
@src/core/run_context.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add RunConfig + orchestrator core loop</name>
  <files>
src/core/__init__.py
src/core/run_config.py
src/core/orchestrator.py
  </files>
  <action>
Implement a time-bounded orchestration loop.

- Define `RunConfig` (duration/steps, headless, record_video, vision_mode, dry_run_github, etc.).
- Implement `TestOrchestrator.run()`:
  - starts browser + recorder
  - runs Explorer for a warm-up window (or interleaves steps)
  - runs Chaos until a bug is found or timeout
  - on bug, calls Reporter (dry-run by default if token missing)
  - ensures artifacts (video/screenshot/bug json/coverage json) are written under one run_id.
- Keep control flow explicit; avoid async complexity unless required.
  </action>
  <verify>
python3 -m compileall src
python3 -c "from src.core.orchestrator import TestOrchestrator; print(TestOrchestrator)"
  </verify>
  <done>
Orchestrator composes the three agents with shared RunContext and stable artifacts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add swarm CLI runner with sensible defaults for demo</name>
  <files>
scripts/run_swarm.py
  </files>
  <action>
Create a CLI that runs the whole system.

- Support modes:
  - `--mode demo` (short, deterministic; stops on first bug)
  - `--mode soak` (longer run)
- Default to recording enabled and reporter dry-run when `GITHUB_TOKEN` missing.
- Print a final summary:
  - run_id
  - coverage stats
  - bug found? and bug json path
  - issue URL (if created).
  </action>
  <verify>
python3 scripts/run_swarm.py --help
  </verify>
  <done>
One command exists to run the swarm end-to-end and produce a coherent summary.
  </done>
</task>

</tasks>

<verification>
- `scripts/run_swarm.py --mode demo` creates `artifacts/<run_id>/...` and exits cleanly.
</verification>

<success_criteria>
- DEMO-01 unblocked: orchestrator coordinates Explorer + Chaos + Reporter.
</success_criteria>

<output>
After completion, create `.planning/phases/05-demo-submit/05-01-SUMMARY.md`
</output>
