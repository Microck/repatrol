---
phase: 04-reporting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/storage/evidence.py
  - src/storage/__init__.py
  - scripts/evidence_smoke.py
autonomous: true

must_haves:
  truths:
    - "Evidence can be stored locally with stable paths"
  artifacts:
    - path: "src/storage/evidence.py"
      provides: "EvidenceStore abstraction + local filesystem implementation"
      contains: "class EvidenceStore"
    - path: "scripts/evidence_smoke.py"
      provides: "Smoke: publish a sample file and print URL/path"
      contains: "--mode"
  key_links: []
---

<objective>
Implement evidence storage so Reporter can reference screenshots/videos from BugReports in a stable, predictable way.

Purpose: REP-04 needs durable evidence references; start with local paths (GitHub publishing is added in 04-02).
Output: EvidenceStore + local filesystem mode.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@src/models/bug.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add EvidenceStore abstraction with local implementation</name>
  <files>
src/storage/__init__.py
src/storage/evidence.py
  </files>
  <action>
Create an abstraction that returns evidence references suitable for issue bodies.

- Define `EvidenceRef` with:
  - `kind` ("screenshot"|"video"|"log")
  - `path` (local)
  - optional `url` (shareable)
- Implement `LocalEvidenceStore`:
  - `publish(path)` returns a ref with local path only
  - no network calls.
  </action>
  <verify>
 python3 -m compileall src
 python3 -c "from src.storage.evidence import LocalEvidenceStore; print(LocalEvidenceStore)"
  </verify>
  <done>
Local evidence store returns stable references for paths under `artifacts/`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add evidence smoke script for local mode</name>
  <files>
 scripts/evidence_smoke.py
  </files>
  <action>
Create `scripts/evidence_smoke.py` that validates end-to-end local evidence refs.

- Generate a small sample file under `artifacts/`.
- Publish via `LocalEvidenceStore.publish(path, kind=...)`.
- Print the resulting `EvidenceRef` (path-only).
  </action>
  <verify>
 python3 scripts/evidence_smoke.py --mode local
  </verify>
  <done>
Evidence smoke runner prints a stable local ref for a sample file.
  </done>
</task>

</tasks>

<verification>
- Evidence refs are stable and live under `artifacts/`.
</verification>

<success_criteria>
- REP-04 partially unblocked: evidence storage API exists and can reference evidence by stable local paths.
</success_criteria>

<output>
After completion, create `.planning/phases/04-reporting/04-01-SUMMARY.md`
</output>
