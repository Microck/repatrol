---
phase: 02-explorer-agent
plan: 02
type: execute
wave: 2
depends_on:
  - "02-01"
files_modified:
  - src/models/coverage.py
  - src/models/__init__.py
  - src/storage/coverage_store.py
  - src/storage/__init__.py
  - scripts/coverage_smoke.py
autonomous: true

must_haves:
  truths:
    - "Coverage is tracked as the Explorer visits new screens/states"
    - "Coverage can be persisted and reloaded across runs"
  artifacts:
    - path: "src/models/coverage.py"
      provides: "Coverage model + update logic"
      contains: "class CoverageTracker"
    - path: "src/storage/coverage_store.py"
      provides: "Persist coverage to disk (JSON)"
      contains: "def save_coverage"
    - path: "scripts/coverage_smoke.py"
      provides: "Smoke: simulate state stream and persist coverage"
      contains: "--out"
  key_links:
    - from: "src/models/coverage.py"
      to: "src/vision/game_state.py"
      via: "uses GameState.screen_id"
      pattern: "screen_id"
---

<objective>
Implement coverage tracking for exploration: record what screens/features were visited, persist the tracker, and compute simple coverage metrics.

Purpose: The Explorer needs a reason to explore systematically and a metric to show judges.
Output: Coverage tracker + persistence + smoke tool.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@src/vision/game_state.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build CoverageTracker that updates from GameState events</name>
  <files>
src/models/__init__.py
src/models/coverage.py
  </files>
  <action>
Implement a tracker that turns a stream of `GameState` objects into coverage signals.

- `CoverageTracker.observe(state: GameState)` updates:
  - `screens_seen` (set of screen_id)
  - `actions_seen` (dedupe action hints)
  - `first_seen_at` per screen
  - `counts` (number of observations)
- Provide `to_dict()` and `from_dict()` for persistence.
- Provide a `coverage_percent()` heuristic based on `screens_seen` and an optional `expected_screens` list in config.
  </action>
  <verify>
python3 -m compileall src
python3 -c "from src.models.coverage import CoverageTracker; print(CoverageTracker().to_dict().keys())"
  </verify>
  <done>
Coverage can be updated from a `GameState` and serialized deterministically.
  </done>
</task>

<task type="auto">
  <name>Task 2: Persist coverage to disk + smoke simulation script</name>
  <files>
src/storage/__init__.py
src/storage/coverage_store.py
scripts/coverage_smoke.py
  </files>
  <action>
Add disk persistence with a single JSON file per run.

- Implement `save_coverage(path, tracker)` and `load_coverage(path)`.
- Add `scripts/coverage_smoke.py` that:
  - generates a handful of fake `GameState` instances (or reads from JSON lines)
  - updates tracker
  - saves to `--out artifacts/coverage.json`
  - reloads and prints summary.
  </action>
  <verify>
python3 scripts/coverage_smoke.py --out artifacts/coverage_smoke.json
  </verify>
  <done>
Coverage persists to disk and reload yields identical summary counts.
  </done>
</task>

</tasks>

<verification>
- `scripts/coverage_smoke.py` produces a JSON file and prints a coherent summary.
</verification>

<success_criteria>
- EXPL-03 unblocked: coverage tracking exists and is persisted.
</success_criteria>

<output>
After completion, create `.planning/phases/02-explorer-agent/02-02-SUMMARY.md`
</output>
